{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>Mother Tracking Dashboard</h2>
    <p>Select a mother below to view their meal history, nutrient totals, and make plan adjustments.</p>

    <input type="hidden" id="doctorId" value="{{ doctor_id }}" />

    <div id="motherListContainer">
        
        <ul id="motherList" class="mother-list">
            </ul>
    </div>
</div>

<div class="card">
  <h3>Mother Queries</h3>
  <button id="refreshQueries" style="margin-bottom:12px;">ðŸ”„ Refresh Queries</button>
  <div id="queriesArea"><em>Loading...</em></div>
</div>

<script>
    function getDoctorId() {
        return document.getElementById("doctorId").value.trim();
    }

    async function loadAssignedMothers() {
        const doctorId = getDoctorId();
        const listElement = document.getElementById("motherList");
        listElement.innerHTML = ''; // Clear loading message

        if (!doctorId) {
            listElement.innerHTML = "<li>Error: Doctor ID not found in session.</li>";
            return;
        }

        try {
            const res = await fetch(`/api/mothers/assigned/${doctorId}`);
            const mothers = await res.json();

            if (!res.ok) {
                listElement.innerHTML = `<li>Error loading data: ${mothers.error || 'Check server logs.'}</li>`;
                return;
            }

            if (mothers.length === 0) {
                listElement.innerHTML = "<li>You currently have no mothers assigned.</li>";
                return;
            }

  const payload = { motherId, title, required_nutrients };
  const res = await fetch("/api/nutrition-plans", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById("planResult").innerHTML = "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
});
</script>

{% endblock %}
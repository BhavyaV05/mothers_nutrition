{% extends "base.html" %}
{% block content %}
<div class="card">
  <h3>Create Daily Nutrient Plan</h3>
  <form id="planForm">
    <label>Mother ID</label>
    <input name="motherId" value="m_1" required />

    <label>Title</label>
    <input name="title" value="Daily Requirement Plan" />

    <label>Required Nutrients (meal-wise JSON)</label>
    <textarea name="required_nutrients" rows="8">
{
  "breakfast": {"kcal": 400, "protein_g": 15, "carb_g": 50, "fat_g": 10},
  "lunch": {"kcal": 700, "protein_g": 25, "carb_g": 90, "fat_g": 20},
  "dinner": {"kcal": 700, "protein_g": 25, "carb_g": 90, "fat_g": 20},
  "snack": {"kcal": 300, "protein_g": 10, "carb_g": 40, "fat_g": 8}
}
    </textarea>

    <button type="submit" style="margin-top:12px;">Save Plan</button>
  </form>
  <div id="planResult"><em>No plan created yet.</em></div>
</div>

<script>
document.getElementById("planForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const f = e.target;
  const motherId = f.elements["motherId"].value.trim();
  const title = f.elements["title"].value;
  let required_nutrients;
  try {
    required_nutrients = JSON.parse(f.elements["required_nutrients"].value);
  } catch (err) {
    document.getElementById("planResult").innerHTML = "<pre>Invalid JSON for required_nutrients</pre>";
    return;
  }

  const payload = { motherId, title, required_nutrients };
  const res = await fetch("/api/nutrition-plans", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById("planResult").innerHTML = "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
});
</script>

{% endblock %}
